# 安全与合规检查项注册表

> **唯一权威定义**：所有安全与合规检查项在此定义，其他文件只能引用ID。
> **适用范围**：ALL = 所有类型 | S = Skill | P = Plugin | M = Memory

## 检查项列表

### 安全检查 (X-0xx)

| ID | 检查项 | 要求 | 严重性 | 适用 |
|----|--------|------|--------|------|
| X-001 | 无硬编码密钥 | 使用环境变量 | Severe | ALL |
| X-002 | 无暴露凭证 | API密钥、密码受保护 | Severe | ALL |
| X-003 | 路径遍历防护 | 清理文件路径 | Severe | S,P |
| X-004 | 输入验证规则 | 验证用户输入 | Warning | S,P |
| X-005 | 命令注入防护 | 清理shell输入 | Severe | S,P |
| X-006 | 无硬编码绝对路径 | 使用相对路径或环境变量 | Severe | S,P |

### 合规检查 (X-1xx)

| ID | 检查项 | 要求 | 严重性 | 适用 |
|----|--------|------|--------|------|
| X-101 | 数据处理规则 | 隐私要求已文档化 | Warning | ALL |
| X-102 | 错误披露 | 错误中无敏感信息 | Warning | S,P |
| X-103 | 审计追踪 | 操作适当记录 | Info | S,P |
| X-104 | 访问控制 | 权限已文档化 | Warning | S,P |

### 跨平台路径 (X-2xx)

| ID | 检查项 | 要求 | 严重性 | 适用 |
|----|--------|------|--------|------|
| X-201 | Shell变量引用 | 所有路径变量用 `"$var"` 包裹 | Severe | S,P |
| X-202 | 命令参数引用 | 路径参数引用：`cmd "$file"` | Severe | S,P |
| X-203 | 区域设置 | 脚本开头包含 `export LANG=en_US.UTF-8` | Warning | S,P |
| X-204 | 参数传递 | 使用 `"$@"` 而非 `$*` | Warning | S,P |

### Python编码 (X-3xx)

| ID | 检查项 | 要求 | 严重性 | 适用 |
|----|--------|------|--------|------|
| X-301 | 编码声明 | 文件顶部 `# -*- coding: utf-8 -*-` | Warning | S,P |
| X-302 | 文件打开编码 | 所有 `open()` 调用用 `encoding='utf-8'` | Severe | S,P |
| X-303 | 子进程路径 | 使用列表形式或 `shlex.quote()` | Severe | S,P |
| X-304 | 路径操作 | 使用 `pathlib.Path` 或 `os.path.join()` | Warning | S,P |

### 脚本调用示例 (X-4xx)

| ID | 检查项 | 要求 | 严重性 | 适用 |
|----|--------|------|--------|------|
| X-401 | 示例中路径引用 | `python "script.py" "路径/文件.txt"` | Severe | S,P |
| X-402 | Windows UTF-8标志 | 包含 `PYTHONUTF8=1` 或 `-X utf8` | Warning | S,P |

## 执行方法

```
1. 搜索硬编码路径、密钥、API密钥
2. 检查脚本注入漏洞
3. 验证路径引用和编码
4. 检查合规要求
5. 输出：「安全检查: 安全N问题; 合规M问题; 路径K问题」
```

## 常见问题模式

| 模式 | 示例 | 严重性 |
|------|------|--------|
| 硬编码密钥 | `api_key = "sk-xxx"` | Severe |
| 未引用路径 | `$path` 或 `${path}` 无引号 | Severe |
| 无编码的open | `open(file)` 无 `encoding='utf-8'` | Severe |
| 命令注入 | `subprocess.run(f'cmd {path}', shell=True)` | Severe |
| 示例路径未引用 | `python script.py 中文.txt` | Severe |

## 不应标记的情况

| 模式 | 原因 |
|------|------|
| 已知ASCII的系统路径 | 无用户输入 |
| 明确标记为平台特定的脚本 | 设计选择 |
| 已验证为仅ASCII的路径 | 上下文感知 |
