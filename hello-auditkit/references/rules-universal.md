# 通用审计规则

> **双重应用**：这些规则既作为：
> 1. **审计标准** 用于检查其他技能
> 2. **质量标准** 被审计内容应遵循的
>
> 被审计内容应遵循的关键原则：AI 执行者意识、简洁性、LLM 措辞模式，以及基于必要性的内容（见 `methodology-core.md`）。

## 目录

- [AI 执行者意识](#ai-执行者意识)
- [基于内容的审计原则](#基于内容的审计原则)
- [通用 Prompt 质量规则](#通用-prompt-质量规则)
- [命名、编号与顺序规则](#命名编号与顺序规则)
- [引用完整性规则](#引用完整性规则)
- [图表与流程图规则](#图表与流程图规则)
- [语言表达规则](#语言表达规则)
- [安全与合规规则](#安全与合规规则)
- [跨平台路径与编码规则](#跨平台路径与编码规则)
- [结构与组织规则](#结构与组织规则)
- [通用尺寸阈值](#通用尺寸阈值)
- [通用格式规则](#通用格式规则)
- [国际化规则](#国际化规则)
- [通用应标记](#通用应标记)
- [通用不应标记](#通用不应标记)

---

## AI 执行者意识

> **依据**：见 `methodology-core.md` → AI 能力模型

### 核心原则

AI 执行者具有上下文理解能力，能从常识和上下文推断。

### 审计检查

| 检查 | 指南 | 严重性 |
|------|------|--------|
| 避免过度指定 | 不要指定 AI 能推断的 | Warning |
| 信任 AI 判断 | 灵活任务用指南而非刚性规则 | Info |
| 无冗余解释 | 不解释 AI 已知的概念 | Warning |

**阈值**：如果 <30% 会误解 → AI 能处理，不要标记。

---

## 基于内容的审计原则

**审计基于用户提供的内容，不限于特定系统路径。**

用户可能：
- 提供复制到任意位置供审查的文件
- 直接粘贴内容
- 指向任意目录结构

**关注**：内容质量本身
**路径/位置检查**：仅供参考（标记为"Info（咨询性）"）

---

## 通用 Prompt 质量规则

> **必须执行**：对于所有包含 AI 指令的内容，验证以下每项检查。
> **详细指导**：见 `type-prompt.md` → LLM 提示词最佳实践
> **动态验证**：执行 SKILL.md 中的步骤 1 获取并与最新 GPT 指南交叉验证。如果链接无法访问或获取的内容不可用，使用本技能的内置规则以离线模式继续并记录原因。

**适用于**：提示词、记忆文件、技能正文、命令正文、代理正文、钩子提示词

### 预检查：意图已传达？

**关键**：在标记任何"缺失"元素之前，首先验证意图是否已传达：

<intent_conveyance_analysis>
"意图是否已传达"的推理过程：
- 检查演示性示例是否暗示预期行为/格式
- 评估 AI 能否从周围上下文推断预期行为
- 应用 30% 阈值测试：没有显式约束 <30% 会误解吗？
- 仅当所有预检查的答案都是否时标记为问题
</intent_conveyance_analysis>

| 检查 | 问题 | 如果是 → | 如果否 → |
|------|------|----------|----------|
| 演示性示例 | 内容是否有暗示预期行为/格式的示例？ | 不是问题（AI 能推断）| 继续规则检查 |
| 上下文清晰度 | AI 能从周围上下文推断预期行为吗？ | 不是问题（AI 能力）| 继续规则检查 |
| 阈值测试 | 没有显式约束 <30% 会误解吗？ | 不是问题（低于阈值）| 继续规则检查 |

**仅当所有预检查的答案都是否时才标记为问题。**

### LLM 提示词最佳实践

| 检查 | 要求 | 严重性 | 适用于 | 预检查 |
|------|------|--------|--------|--------|
| 详尽约束 | 输出长度指导（显式限制或演示性示例）| 仅当 AI 无法推断时为 Severe | 所有提示词 | 检查示例是否暗示长度 |
| 范围边界 | 边界已传达（显式"禁止"或清晰上下文）| 仅当 AI 无法推断时为 Severe | 所有指令 | 检查上下文是否暗示范围 |
| 禁止捏造 | 事实性内容有"禁止捏造..."指令 | Severe | 数据提取 | 事实性任务始终需要 |
| 歧义处理 | 不清楚情况的指令（澄清或解释）| Warning | 复杂任务 | - |
| 无 AI 已知内容 | 不解释标准概念 | Warning | 所有 | - |
| 接地 | 不确定声明有"基于上下文" | Warning | 数据提取 | - |
| 自检 | 高风险输出有验证步骤 | Warning | 法律/财务/安全 | - |
| 输出模式 | JSON 结构或格式规范 | Warning | 结构化输出 | 检查示例是否展示格式 |
| 工具偏好 | 获取新鲜/用户特定数据时优先使用工具而非内部知识 | Warning | 工具使用内容 | - |
| 工具并行化 | 并行化独立的读取操作 | Info | 工具使用内容 | - |
| 写入确认 | 写入后重述：改变了什么、在哪里、执行了什么验证 | Warning | 工具使用内容 | - |
| 代理式更新 | 仅在主要阶段简短更新（1-2 句），具体结果 | Warning | 代理/代理式内容 | - |
| 禁止任务扩展 | 不超出用户请求扩展；标记可选工作 | Warning | 代理/代理式内容 | - |
| 长上下文大纲 | >10k token：内部大纲、约束重述、带引用的章节引用 | Warning | 长内容 | - |
| 结构化空值处理 | 缺失字段 → null，不猜测；返回前重新扫描 | Warning | 结构化输出 | - |

### 自由度匹配

| 任务类型 | 预期约束级别 | 不匹配时的问题 |
|----------|-------------|---------------|
| 脆弱/确定性操作 | 具体脚本 | 如果太松则 Severe |
| 数据提取 | 严格模式 | 如果无结构则 Severe |
| 创意/灵活任务 | 仅指南 | 如果过度约束则 Warning |
| 代码生成 | 模式 + 灵活性 | 如果太刚性则 Warning |
| 对话式/多阶段 | 强约束 + 显式门 | 如果规则分散或缺少门则 Severe |

> **注意**：对于对话式/多阶段内容，见 `type-prompt.md` → 对话式/多阶段提示词规则了解详细检查。

### 简洁性原则

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 单一信息源 | 信息只在一个地方 | Warning |
| 无重复 | 不同时在正文和参考文件中 | Warning |
| 偏好示例 | 优于冗长解释 | Info |
| 移除 AI 已知 | 不解释常见概念 | Warning |

### 触发条件放置

| 内容类型 | 触发位置 | 正文包含 |
|----------|----------|----------|
| 技能 | description 字段 | 实现 |
| 代理 | description 字段 | 指令 |
| 命令 | description 字段 | 任务指令 |
| 钩子 | matcher 配置 | 操作逻辑 |

**问题**：触发条件在正文而非描述中 → Severe

---

## 命名、编号与顺序规则

> **必须执行**：从内容中提取实际名称和编号并验证。

### 命名验证

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 命名风格一致 | 全文相同格式（kebab-case、snake_case 等）| Warning |
| 标识符使用 kebab-case | 文件、目录使用 kebab-case（SKILL.md 除外）| Warning |
| 无空格/特殊字符 | 仅使用字母、数字、连字符 | Severe |
| 描述性名称 | 名称反映内容/目的 | Warning |
| 无重复名称 | 范围内每个标识符唯一 | Severe |

### 编号验证

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 连续编号 | 无缺口（1,2,3 而非 1,2,4）| Warning |
| 格式一致 | 相同风格（R1/R2 或 1.1/1.2）| Warning |
| 引用的编号存在 | 所有引用的 R1、步骤 2 等存在 | Severe |
| 无重复编号 | 每个编号只使用一次 | Warning |
| 层次一致性 | 1.1、1.2 在章节 1 下 | Warning |

### 顺序验证

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 章节顺序逻辑 | 前提在依赖之前 | Warning |
| 标题层次 | H1→H2→H3（不跳级）| Warning |
| 目录匹配内容 | 目录顺序 = 章节顺序 | Warning |
| 优先级顺序 | 高优先级项在前 | Info |
| 时间顺序流 | 步骤按执行顺序 | Warning |

---

## 引用完整性规则

> **必须执行**：从内容中提取所有引用（文件引用、锚点链接、编号引用、Markdown 链接、相对路径）并验证每个存在。
> **关键**：断链引用是常见的审计失败。此章节必须彻底执行。

### 引用检测（完整）

| 类型 | 模式 | 必须检测 |
|------|------|----------|
| 导入引用 | `@file`、`@path/file` | 是 |
| Markdown 链接 | `[text](path)`、`[text](path#anchor)` | 是 |
| 锚点链接 | `#section-name` | 是 |
| 编号引用 | `R1`、`Step 2`、`Section 1.1` | 是 |
| 跨文件引用 | `file.md#section` | 是 |
| 相对路径 | `./path`、`../path` | 是 |
| 隐式文本引用 | `see xxx`、`refer to xxx` | 是 |

### 引用准确性

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 命名引用存在 | 所有 `@file`、`skill-name` 存在 | Severe |
| 编号引用存在 | 所有 R1、步骤 2 等已定义 | Severe |
| 锚点链接有效 | #section-name 锚点解析（不区分大小写、kebab-case 规范化）| Severe |
| 跨文件引用有效 | 对其他文件的引用存在 | Severe |
| 相对路径解析 | ./path、../path 正确解析 | Severe |
| Markdown 链接有效 | [text](path) 目标存在 | Severe |
| 无孤立引用 | 无未定义引用 | Warning |

### 锚点验证（重要）

> **关键**：锚点必须通过正确的格式规范化验证。

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 大小写规范化 | `#My-Section` 应匹配 `## My Section` | Severe |
| 特殊字符移除 | `#api-config` 应匹配 `## API & Config` | Severe |
| 空格转连字符 | `#my-section` 应匹配 `## My Section` | Severe |

### 常见断链引用模式

| 模式 | 示例 | 问题 |
|------|------|------|
| 锚点大小写不匹配 | `#My-Section` vs `## my section` | 大小写未规范化 |
| 缺少扩展名 | `see rules` vs `rules.md` | 省略了扩展名 |
| 相对路径错误 | `../wrong/path.md` | 路径无法解析 |
| 重命名/移动的文件 | `old-name.md` | 文件已重命名 |
| 引用中的拼写错误 | `refrence.md` | 拼写错误 |
| 过时的编号引用 | `see R5` | R5 已删除 |

### 引用一致性

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 相同引用 = 相同格式 | 引用风格一致 | Warning |
| 双向完整性 | 如果 A 引用 B，B 应引用 A（如需要）| Info |
| 无循环引用 | A→B→C→A 模式 | Fatal |
| 无冲突引用 | 相同名称 ≠ 不同目标 | Severe |

---

## 图表与流程图规则

> **必须执行**：如果存在图表，验证每个节点有文本描述且所有路径有端点。

### 目录树验证

在报告"树不完整"或"缺少文件"之前：重读并完整解析树结构以确认。ASCII 树字符在首次扫描时可能导致解析错误。

### 图表-文本一致性

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 节点名称匹配文本 | 图表节点 = 文本描述 | Severe |
| 流程路径匹配规则 | 图表路径 = 文档化流程 | Severe |
| 所有路径有文档 | 每条图表路径有描述 | Warning |
| 无未文档化节点 | 每个节点都有解释 | Warning |
| 条件匹配 | 决策条件一致 | Severe |

### 流程图逻辑验证

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 所有路径有端点 | 无悬挂分支 | Fatal |
| 无无限循环 | 所有循环有退出条件 | Fatal |
| 决策完整性 | 所有决策分支都处理 | Severe |
| 有开始/结束节点 | 清晰的入口和出口点 | Warning |
| 符号一致 | 全文相同符号 | Info |

### Mermaid/图表语法

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 语法有效 | 渲染无错误 | Severe |
| 节点 ID 匹配引用 | 引用的节点存在 | Severe |
| 边标签清晰 | 条件可读 | Info |

---

## 语言表达规则

> **必须执行**：扫描下列歧义模式。如果发现且无条件/上下文则标记。

### 清晰与精确

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 措辞清晰 | 无歧义短语 | Warning |
| 表达流畅 | 语法正确 | Warning |
| 无拼写错误 | 扫描标识符、标题、关键术语的拼写错误 | Info |
| 无冗余 | 无不必要的重复 | Warning |
| 动词时态一致 | 全文相同时态 | Info |

### 歧义检测

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 模糊量词/时间 | 必须具体或有上下文 | Warning |
| 未定义标准 | "适当/合适"需要定义 | Warning |
| 不完整枚举 | "等"应有示例或穷尽 | Info |

### 术语一致性

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 同概念 = 同术语 | 每个概念一个术语 | Warning |
| 领域术语有定义 | 技术术语有解释 | Info |
| 动词形式一致 | 相同动作用相同动词 | Warning |
| 格式一致 | 相同元素用相同样式 | Warning |

### 示例-规则一致性

> **关键**：与规则矛盾的示例会导致混乱和错误执行。

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 格式匹配 | 示例遵循规则指定的格式 | Severe |
| 值约束 | 示例值满足规则约束 | Severe |
| 术语匹配 | 示例使用与规则相同的术语 | Warning |
| 结构匹配 | 示例结构遵循规则规范 | Severe |
| 无过时模式 | 示例使用当前模式 | Warning |

### 常见示例-规则不一致

| 模式 | 规则 | 示例 | 问题 |
|------|------|------|------|
| 命名不匹配 | "使用 kebab-case" | `my_var_name` | 错误约定 |
| 约束违反 | "≤5 项" | 展示 8 项 | 超出限制 |
| 格式不匹配 | "JSON 输出" | 纯文本 | 错误格式 |
| 术语漂移 | "使用'task'" | 说"job" | 不同术语 |

### 措辞模式（LLM 最佳实践）

> **权威来源**：`ref-gpt-prompting-standard.md`
> **完整检查**：见 `ref-checklist.md` → 维度 0.9：结构化标签

#### 快速参考 - 推荐模式

| 模式 | 示例 | 缺失时严重性 |
|------|------|-------------|
| 详尽约束 | "≤N 句/要点" | Warning |
| 范围约束 | "完全且仅限所请求内容" | Warning |
| 禁止捏造 | "禁止捏造..." | Severe |
| 强停止条件 | 阶段门有"停止并等待" | Severe |
| 约束集中 | 关键规则在顶部，≤3 处 | Severe |

#### 快速参考 - 反模式

| 反模式 | 为何有问题 | 严重性 |
|--------|-----------|--------|
| 模糊详尽性（"简洁一点"）| 无可衡量约束 | Warning |
| 填充短语 | 现代 LLM 视为噪音 | Warning |
| 矛盾指令 | 浪费推理 token | Severe |
| 分散约束（>3 处）| 选择性遵循 | Severe |

#### 结构化标签块

复杂提示词的**最佳实践**：使用 `<tag>...</tag>` 包裹约束。

| 验证 | 严重性 |
|------|--------|
| 未闭合/孤立标签 | Fatal |
| 标签名称有空格 | Severe |
| 非 snake_case 命名 | Warning |

#### 推理标签

**命名**：`<{领域}_{动作}>` 格式（如 `<severity_assessment_reasoning>`）

**关键规则**：标签仅包裹**判断标准**，不包含执行步骤。

---

## 安全与合规规则

> **必须执行**：搜索硬编码的路径、秘密、API 密钥。检查脚本的注入漏洞。

### 安全检查

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 无硬编码秘密 | 使用环境变量 | Severe |
| 无暴露凭据 | API 密钥、密码受保护 | Severe |
| 路径遍历预防 | 清理文件路径 | Severe |
| 输入验证规则 | 验证用户输入 | Warning |
| 命令注入预防 | 清理 shell 输入 | Severe |

### 合规检查

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 数据处理规则 | 隐私要求有文档 | Warning |
| 错误披露 | 错误中无敏感信息 | Warning |
| 审计追踪 | 操作适当记录 | Info |
| 访问控制 | 权限有文档 | Warning |

---

## 跨平台路径与编码规则

> **必须执行**：检查所有脚本和脚本调用示例的正确路径引号和 UTF-8 编码支持。这确保 Windows 上与非 ASCII 路径（如中文字符）的兼容性，同时保持 Mac/Linux 兼容性。

### 核心原则

**所有文件路径和目录名称必须用双引号包裹**，以在所有平台上正确处理空格和非 ASCII 字符（中文、日文等）。

### Shell 脚本要求

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 变量引号 | 所有路径变量用 `"$var"` 包裹 | Severe |
| 命令参数 | 路径参数引号：`cmd "$file"` | Severe |
| 语言环境设置 | 脚本开头包含 `export LANG=en_US.UTF-8` | Warning |
| 参数传递 | 使用 `"$@"` 而非 `$*` | Warning |

**正确模式**：
```bash
#!/bin/bash
export LANG=en_US.UTF-8
cp "$source_file" "$dest_dir/"
```

**错误模式**：
```bash
cp $source_file $dest_dir/  # 中文/空格路径会失败
```

### Python 脚本要求

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 编码声明 | 文件顶部有 `# -*- coding: utf-8 -*-` | Warning |
| 文件打开编码 | 所有 `open()` 调用有 `encoding='utf-8'` | Severe |
| Subprocess 路径 | 使用列表形式或 `shlex.quote()` | Severe |
| 路径操作 | 使用 `pathlib.Path` 或 `os.path.join()` | Warning |

**正确模式**：
```python
# -*- coding: utf-8 -*-
from pathlib import Path
content = Path(file_path).read_text(encoding='utf-8')
```

**错误模式**：
```python
content = open(file_path).read()  # 未指定编码
```

### 脚本调用示例要求

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 示例中路径有引号 | `python "script.py" "路径/文件.txt"` | Severe |
| Windows 的 UTF-8 标志 | 包含 `PYTHONUTF8=1` 或 `-X utf8` | Warning |

**正确文档**：
```markdown
# 运行：
python3 "scripts/process.py" "输入文件.txt" "输出目录/"

# 或在 Windows 上显式 UTF-8：
PYTHONUTF8=1 python3 "scripts/process.py" "中文路径/file.txt"
```

**错误文档**：
```markdown
# 运行：
python3 scripts/process.py 输入文件.txt 输出目录/
```

### 审计执行步骤

1. **扫描所有 `.sh` 文件**：
   - 检查路径上下文中未引号的 `$variable`
   - 检查语言环境/编码设置

2. **扫描所有 `.py` 文件**：
   - 检查 `open()` 调用是否有 `encoding='utf-8'`
   - 检查 subprocess 调用是否正确引号

3. **扫描文档/示例**：
   - 检查脚本调用示例是否有路径引号
   - 检查是否有 UTF-8 标志建议

### 应标记（跨平台）

| 问题 | 严重性 |
|------|--------|
| shell 中 `$path` 或 `${path}` 无引号 | Severe |
| `open(file)` 无 `encoding='utf-8'` | Severe |
| `subprocess.run(f'cmd {path}', shell=True)` | Severe |
| 调用示例中路径无引号 | Severe |
| shell 脚本缺少语言环境设置 | Warning |
| Python 缺少编码声明 | Warning |

### 不应标记

| 模式 | 原因 |
|------|------|
| 已知为 ASCII 的系统路径 | 无用户输入 |
| 标记为特定平台的脚本 | 有意为之 |
| 已验证为仅 ASCII 的路径 | 上下文感知 |

---

## 结构与组织规则

> **必须执行**：通过比较实际条目验证目录-内容匹配。

### 章节结构

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 有目录（>100 行）| 目录用于导航 | Info |
| 目录-内容匹配 | 每个目录条目有对应标题 | Warning |
| 逻辑分组 | 相关内容放在一起 | Warning |
| 清晰边界 | 章节明确分隔 | Info |
| 无孤立章节 | 所有章节集成 | Warning |

### 规则组织

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 单一信息源 | 规则在一处定义 | Warning |
| 无分散规则 | 相同规则不在 >3 文件中 | Warning |
| 无语义重复 | 无含义相同但措辞不同的规则 | Warning |
| 正确分类 | 规则在正确章节 | Warning |
| 层级适当 | 全局 vs 本地规则正确 | Warning |

### 模板合规

| 检查 | 要求 | 严重性 |
|------|------|--------|
| 必需章节存在 | 所有强制章节存在 | Severe |
| 章节顺序正确 | 章节按预期顺序 | Warning |
| 格式一致 | 类似文件相同格式 | Warning |

---

## 通用尺寸阈值

> 基于官方 Agent Skills 规范 (agentskills.io/specification)

### SKILL.md 正文（官方要求）

| 范围 | 状态 | 严重性 |
|------|------|--------|
| ≤500 行 | 理想 | - |
| 500-550（≤10% 超出）| **不是问题** | - |
| 550-625（10-25% 超出）| 仅 Info | Info |
| >625 行 | 应优化 | Warning |

> **来源**："保持主 `SKILL.md` 在 500 行以下。将详细参考材料移到单独文件。"

### 参考文件（软限制）

**官方指导**："保持单个参考文件专注。代理按需加载这些文件，所以较小的文件意味着更少的上下文使用。"

**软限制**（上下文效率优化）：

| 范围 | 状态 | 严重性 |
|------|------|--------|
| ≤300 行 | 理想 | - |
| 300-500 行 | 可接受 | - |
| 500-800 行 | 应考虑拆分 | Info |
| >800 行 | 应拆分或去重 | Warning |

**标记大文件之前评估**：
- 内容有不可分割的完整性吗？（如完整 API 规范）
- 拆分会导致加载遗漏或破坏交叉引用吗？
- 有明显可以精简的冗余吗？

**仅当**：文件大且有明显冗余或可以无功能影响地拆分时才标记。

### 组件摘要

| 组件 | 限制 | 备注 |
|------|------|------|
| L1 元数据 | ~100 词 | 永久上下文成本 |
| L2 正文（SKILL.md）| <500 行 | 官方要求 |
| L3 参考文件 | <500 行（软）| 为上下文效率优化 |
| L4 脚本 | 无限制 | 仅运行时 |

---

## 通用格式规则

### Frontmatter 验证

| 字段 | 规则 | 严重性 |
|------|------|--------|
| 必需字段 | 必须存在且非空 | Fatal/Severe |
| name | kebab-case、适当长度 | Warning |
| description | 包含触发条件、简洁 | Severe |
| 有效 YAML | 可解析、语法正确 | Fatal |

### Markdown 结构

| 检查 | 规则 | 严重性 |
|------|------|--------|
| 标题层次 | H1→H2→H3（不跳级）| Warning |
| 表格格式 | 有效的 markdown 表格 | Warning |
| 代码块 | 正确的语言标签 | Info |
| 链接 | 有效的内部/外部链接 | Warning |

### 命名约定

| 元素 | 约定 | 严重性 |
|------|------|--------|
| 目录 | kebab-case | Warning |
| 文件 | kebab-case（SKILL.md 除外）| Warning |
| 无空格 | 使用连字符代替 | Severe |
| 无特殊字符 | 仅字母、数字、连字符 | Severe |
| 文件编码 | UTF-8 无 BOM | Warning |

---

## 国际化规则

### 当声明了国际化时

**适用于**：内容有任何语言/区域配置时

| 检查 | 指南 | 严重性 |
|------|------|--------|
| 无硬编码面向用户的文本 | 使用变量/模板 | Warning |
| 无固定语言输出示例 | 使用 `{example_output}` 占位符 | Warning |
| 语言无关规则 | 规则不应假设特定语言 | Info |
| BCP 47 语言标签 | 标准格式如 `zh-CN`、`en-US` | Warning |

### 硬编码内容例外

**不要标记**：
- 许可证/版权声明
- 技术术语（API、JSON 等）
- 展示语法（非内容）的代码示例
- 变量/函数名
- 调试用日志消息
- **官方文档/规范/标准内容**（API 参数、协议值、格式定义）
- **必要的禁止规则**（用于范围控制、安全约束的"禁止"列表）
- **必要的澄清示例**（当规则没有示例会模糊时）

> **关键原则**：见 `methodology-core.md` → "ADD 必要的情况"了解完整标准。

---

## 通用应标记

### 致命问题（阻止执行）

- 矛盾规则（A vs NOT A）— **警告**：对现代推理模型特别有害（浪费推理 token 试图调和）
- 不可能的条件
- 循环引用（A→B→C→A）
- 缺少必需字段
- 无效语法（JSON、YAML 等）
- 引用的文件/组件不存在

### 严重问题（重大影响）

- 硬编码绝对路径（应使用相对路径或环境变量）
- 描述中缺少触发条件
- ≥60% 执行者错误率
- 核心工作流在错误位置
- 安全漏洞（注入、秘密）
- 无效的工具/模型/事件名称
- shell 脚本中文件/目录路径无引号（中文/空格路径会失败）
- Python `open()` 调用缺少 `encoding='utf-8'`
- subprocess shell 命令中路径无引号
- 脚本调用示例中非 ASCII 路径无引号

### 警告（次优）

- SKILL.md 正文 >625 行（仅适用于 SKILL.md，不适用于参考文件）
- 参考文件缺少"何时读取"
- 模糊指令（"做好它"）
- 术语不一致且无解释
- 缺少错误处理
- 非 kebab-case 命名
- shell 脚本缺少 UTF-8 语言环境设置
- Python 脚本缺少 UTF-8 编码声明

### 信息（建议）

- SKILL.md 正文 550-625 行（10-25% 超出）
- 可受益于示例
- 轻微风格差异
- 可选字段缺失
- 优化机会

---

## 通用不应标记

### AI 推断能力

**关键**：当 AI 能推断正确行为时不要标记为问题：

| 模式 | 原因 | 示例 |
|------|------|------|
| 无显式约束但有演示性示例 | AI 能从示例推断 | 示例展示 3-5 个要点格式 → AI 理解长度期望 |
| 无显式规则但上下文明确暗示行为 | AI 能力 | "工程投标"上下文 → AI 理解数据应来自提供的材料 |
| 原始设计通过结构/示例传达意图 | 添加显式规则是冗余的 | 结构化示例输出 → 暗示格式要求 |
| 占位符模式表明预期行为 | AI 理解占位符语义 | `{{内容来自材料}}` → AI 知道要提取，不是捏造 |

### 尺寸容忍

- ≤10% 超出推荐 → **不是问题**
- 504/500 行 → **不是问题**（仅 0.8% 超出）
- 520/500 行 → **不是问题**（仅 4% 超出）

### 设计选择

- 不同目录命名（commands/ vs cmds/）
- 不同文件组织
- 规范内的风格变化
- 平台特定模式（Claude vs Codex）
- 使用不同的有效方法

### 有意内容

- 许可证/版权声明
- 品牌标识
- 输出中的固定页眉/页脚
- 技术规范
- 演示语法的代码示例

### AI 能力

- AI 能从上下文推断的内容
- 标准术语无需定义
- 常见模式无需解释
- 明显的约束

### 可选元素

- 缺少可选字段
- 缺少 README.md
- 缺少版本字段
- 额外的辅助目录

### 跨平台路径处理

- 已知为仅 ASCII 的系统路径（无用户输入）
- 明确标记为特定平台的脚本
- 上游已验证或清理的路径
- 有文档说明仅 ASCII 使用的内部脚本

---

## 严重性决策矩阵

> **权威来源**：`methodology-core.md` → 五点核心验证、必要性阈值

### 快速参考

| 条件 | 严重性 |
|------|--------|
| 完全无法执行 | Fatal |
| ≥60% 严重错误 | Severe |
| ≥3 个冲突解释 | Severe |
| ≥40% 误解 | Warning |
| 常见情况 ≥20% 失败 | Warning |
| ≥30% 改进可能，<10% 成本 | Info |
| <10% 超出推荐 | 不是问题 |
| AI 能推断 | 不是问题 |
| 设计选择 | 不是问题 |

### 验证问题

> **完整五点检查**：见 `methodology-core.md` → 五点核心验证

在标记任何问题之前，验证：(1) 具体影响？(2) 在范围内？(3) 缺陷还是选择？(4) 达到阈值？

如果任何答案是否 → 丢弃该问题
